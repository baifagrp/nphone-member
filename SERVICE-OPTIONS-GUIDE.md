# 服務選項功能說明

## 📋 功能簡介

服務選項功能讓您可以為每個服務設定子選項（例如：手機型號），會員在預約時可以選擇具體的型號。

## 🎯 使用場景

- **貼膜服務** → 選擇手機型號（iPhone 15 Pro、Samsung S24 等）
- **維修服務** → 選擇故障類型（螢幕破裂、電池更換等）
- **清潔服務** → 選擇清潔程度（基礎、深度清潔等）

## 🔧 資料庫結構

### services 表新增欄位
- `base_price` - 基礎價格（替代原本的 price）
- `has_options` - 是否有選項（true/false）
- `option_label` - 選項標籤（例如：「手機型號」）

### service_options 表
- `service_id` - 關聯的服務 ID
- `name` - 選項名稱（例如：「iPhone 15 Pro」）
- `price_modifier` - 價格調整（可增加或減少，例如：+200 或 -100）
- `is_active` - 是否啟用
- `sort_order` - 排序順序

### bookings 表新增欄位
- `service_option_id` - 選擇的選項 ID
- `service_option_name` - 選項名稱（快照）
- `service_price` - 最終價格（基礎價格 + 選項價格調整）

---

## 📝 使用方式

### 1. 管理後台：設定服務選項

1. 進入「服務項目管理」
2. 新增或編輯服務
3. 勾選「此服務需要選擇子項」
4. 填寫「選項標籤」（例如：「手機型號」）
5. 點擊「+ 新增選項」
6. 輸入選項名稱和價格調整
7. 儲存

**範例**：
- 服務：基礎貼膜
- 基礎價格：500 元
- 選項標籤：手機型號
- 選項：
  - iPhone 15 Pro Max：+0 元（總價 500）
  - iPhone 14：+0 元（總價 500）
  - 其他型號：+100 元（總價 600）

### 2. 會員端：選擇服務選項

1. 進入「線上預約」
2. 選擇服務（例如：基礎貼膜）
3. **如果服務有選項，會自動進入選項選擇頁面**
4. 選擇手機型號（例如：iPhone 15 Pro Max）
5. 繼續選擇日期和時間
6. 確認預約

---

## 💡 價格計算邏輯

**最終價格 = 基礎價格 + 選項價格調整**

範例：
- 基礎貼膜：基礎價格 500 元
- iPhone 15 Pro Max：價格調整 +0 元
- **最終價格 = 500 + 0 = 500 元**

- 基礎貼膜：基礎價格 500 元
- 其他型號：價格調整 +100 元
- **最終價格 = 500 + 100 = 600 元**

---

## 🔄 預約流程更新

**原本流程**（4步驟）：
1. 選擇服務
2. 選擇日期
3. 選擇時間
4. 確認預約

**新流程**（5步驟，如果服務有選項）：
1. 選擇服務
2. **選擇選項** ← 新增
3. 選擇日期
4. 選擇時間
5. 確認預約

**如果服務沒有選項，則跳過步驟 2**

---

## 📊 預約記錄顯示

### 會員端
- 預約列表中會顯示選擇的型號
- 例如：「基礎貼膜 - iPhone 15 Pro Max」

### 管理後台
- 預約詳情中會顯示選擇的型號
- 價格會顯示最終價格（已包含選項調整）

---

## ✅ 完成項目

- [x] 資料庫結構設計
- [x] 服務選項表建立
- [x] RLS 安全政策
- [x] RPC 函數更新（支援選項）
- [x] 會員端預約流程更新
- [x] 管理後台服務選項管理
- [x] 預約記錄顯示選項資訊

---

## 🎉 功能特色

- ✅ 靈活的選項設定（每個服務可設定不同選項）
- ✅ 價格調整功能（選項可調整價格）
- ✅ 自動價格計算
- ✅ 選項資訊會快照到預約記錄
- ✅ 友善的使用者介面

---

## 📚 相關檔案

- `supabase/booking-schema.sql` - 資料庫結構（已更新）
- `supabase/booking-rls-policies.sql` - 安全政策（已更新）
- `js/booking.js` - API 函數（已更新）
- `member/booking.html` - 預約頁面（已更新）
- `admin/services.html` - 服務管理頁面（已更新）

---

服務選項功能已完成！現在會員在預約時可以選擇具體的手機型號了！📱✨

