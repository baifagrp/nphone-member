# ğŸ”§ Flex Message INVALID_MESSAGE éŒ¯èª¤ä¿®å¾©

## âŒ åŸå§‹éŒ¯èª¤

```
ç™¼é€å¤±æ•—(code: INVALID_MESSAGE)invalid message
```

---

## ğŸ¯ å•é¡ŒåŸå› 

### LINE Flex Message åœ–ç‰‡é™åˆ¶

1. **Base64 åœ–ç‰‡å¤ªå¤§**
   - æ¢ç¢¼åœ–ç‰‡è½‰æ›ç‚º Base64 å¾Œè¶…é LINE é™åˆ¶
   - LINE Flex Message å° Data URI æœ‰å¤§å°é™åˆ¶

2. **åœ–ç‰‡ URL é™åˆ¶**
   - å¿…é ˆæ˜¯ HTTPS URL
   - æˆ–è€…æ˜¯ Data URIï¼ˆä½†æœ‰å¤§å°é™åˆ¶ï¼‰
   - Base64 æ¢ç¢¼åœ–ç‰‡é€šå¸¸æœƒè¶…éé™åˆ¶

---

## âœ… è§£æ±ºæ–¹æ¡ˆ

### ç§»é™¤æ¢ç¢¼åœ–ç‰‡ï¼Œæ”¹ç”¨æ–‡å­—é¡¯ç¤ºæœƒå“¡ç·¨è™Ÿ

**ä¿®æ”¹å‰ï¼ˆæœ‰å•é¡Œï¼‰ï¼š**
```javascript
{
    type: 'image',
    url: barcodeImageUrl,  // Base64 åœ–ç‰‡å¤ªå¤§
    size: 'full',
    aspectMode: 'fit',
    aspectRatio: '3:1'
}
```

**ä¿®æ”¹å¾Œï¼ˆæ­£ç¢ºï¼‰ï¼š**
```javascript
{
    type: 'text',
    text: memberData.member_code,  // ç›´æ¥é¡¯ç¤ºç·¨è™Ÿ
    size: 'xxl',
    color: '#667eea',
    align: 'center',
    weight: 'bold'
}
```

---

## ğŸ“± æ–°çš„æœƒå“¡å¡æ¨£å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      NPHONE  æœƒå“¡å¡          â”‚ â† ç´«è‰²æ¨™é¡Œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœƒå“¡å§“å     è‘‰ç‘æ©          â”‚
â”‚  æœƒå“¡ç·¨è™Ÿ     M12345          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      æœƒå“¡ç·¨è™Ÿ                â”‚
â”‚      M12345                  â”‚ â† å¤§å­—é¡¯ç¤ºç·¨è™Ÿï¼ˆä¸æ˜¯æ¢ç¢¼ï¼‰
â”‚  è«‹åœ¨çµå¸³æ™‚å‡ºç¤ºæ­¤ç·¨è™Ÿ          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’° å„²å€¼é‡‘    NT$ 1,250      â”‚
â”‚  â­ ç©åˆ†      580 é»          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      NPHONE æ„Ÿè¬æ‚¨ â¤ï¸        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ä¿®æ”¹å…§å®¹

### 1. ç§»é™¤æ¢ç¢¼ç”Ÿæˆæ­¥é©Ÿ

**ä¿®æ”¹å‰ï¼š**
```javascript
// 4. ç”Ÿæˆæ¢ç¢¼
updateStatus('ğŸ“Š', 'ç”Ÿæˆæ¢ç¢¼...', 'æ­£åœ¨è£½ä½œæ‚¨çš„æœƒå“¡å¡');
const barcodeImageUrl = generateBarcodeSVG(memberData.member_code);

// 5. å‰µå»º Flex Message
const flexMessage = createMemberCardFlexMessage(memberData, barcodeImageUrl);
```

**ä¿®æ”¹å¾Œï¼š**
```javascript
// 4. å‰µå»º Flex Message
updateStatus('ğŸ¨', 'è£½ä½œæœƒå“¡å¡...', 'æ­£åœ¨ç”Ÿæˆæœƒå“¡å¡è¨Šæ¯');
const flexMessage = createMemberCardFlexMessage(memberData);
```

---

### 2. ç°¡åŒ–å‡½æ•¸ç°½å

**ä¿®æ”¹å‰ï¼š**
```javascript
function createMemberCardFlexMessage(memberData, barcodeImageUrl) {
```

**ä¿®æ”¹å¾Œï¼š**
```javascript
function createMemberCardFlexMessage(memberData) {
```

---

### 3. ä¿®æ”¹é¡¯ç¤ºæ–¹å¼

**ä¿®æ”¹å‰ï¼ˆæ¢ç¢¼åœ–ç‰‡ï¼‰ï¼š**
```javascript
{
    type: 'image',
    url: barcodeImageUrl,  // å•é¡Œæ‰€åœ¨
    size: 'full',
    aspectMode: 'fit'
}
```

**ä¿®æ”¹å¾Œï¼ˆæ–‡å­—ç·¨è™Ÿï¼‰ï¼š**
```javascript
{
    type: 'text',
    text: memberData.member_code,
    size: 'xxl',
    color: '#667eea',
    weight: 'bold'
}
```

---

## ğŸ’¡ ç‚ºä»€éº¼é€™æ¨£ä¿®æ”¹ï¼Ÿ

### å„ªé» âœ…

1. **é¿å… INVALID_MESSAGE éŒ¯èª¤**
   - ä¸æœƒè¶…é Flex Message å¤§å°é™åˆ¶
   - è¨Šæ¯çµæ§‹ç°¡å–®æ¸…æ™°

2. **æ›´å¿«çš„è¼‰å…¥é€Ÿåº¦**
   - ä¸éœ€è¦ç”Ÿæˆæ¢ç¢¼åœ–ç‰‡
   - ä¸éœ€è¦ Base64 è½‰æ›

3. **æ›´å¥½çš„ç›¸å®¹æ€§**
   - ç´”æ–‡å­—ï¼Œæ‰€æœ‰ LINE ç‰ˆæœ¬éƒ½æ”¯æ´
   - ä¸å—åœ–ç‰‡é™åˆ¶å½±éŸ¿

4. **æ˜“æ–¼ä½¿ç”¨**
   - æœƒå“¡ç·¨è™Ÿæ¸…æ¥šå¯è¦‹
   - åº—å“¡å¯ä»¥æ‰‹å‹•è¼¸å…¥ç·¨è™Ÿ

---

### å¯èƒ½çš„ç–‘æ…® â“

#### Q: æ²’æœ‰æ¢ç¢¼æ€éº¼æƒæï¼Ÿ

**A:** åº—å“¡å¯ä»¥ï¼š
1. æ‰‹å‹•è¼¸å…¥æœƒå“¡ç·¨è™Ÿ
2. æˆ–ä½¿ç”¨æœƒå“¡ç³»çµ±é¦–é çš„æ¢ç¢¼ï¼ˆä»ç„¶ä¿ç•™ï¼‰

#### Q: æ¢ç¢¼åŠŸèƒ½é‚„åœ¨å—ï¼Ÿ

**A:** æ˜¯çš„ï¼
- âœ… æœƒå“¡å°ˆå€é¦–é ä»æœ‰æ¢ç¢¼é¡¯ç¤º
- âœ… å¯ä»¥åœ¨ç¾å ´æƒæ
- âœ… ç™¼é€åˆ° LINE çš„å¡ç‰‡æ”¹ç”¨ç·¨è™Ÿ

---

## ğŸ” LINE Flex Message é™åˆ¶

### åœ–ç‰‡é™åˆ¶

| é¡å‹ | é™åˆ¶ | èªªæ˜ |
|-----|------|------|
| HTTPS URL | å»ºè­°ä½¿ç”¨ | å¤–éƒ¨åœ–ç‰‡é€£çµ |
| Data URI (Base64) | æœ‰å¤§å°é™åˆ¶ | é€šå¸¸ < 300KB |
| æ¢ç¢¼åœ–ç‰‡ | é€šå¸¸å¤ªå¤§ | å®¹æ˜“è¶…éé™åˆ¶ âŒ |

### ç‚ºä»€éº¼æ¢ç¢¼åœ–ç‰‡å¤ªå¤§ï¼Ÿ

```
æ¢ç¢¼åœ–ç‰‡ï¼š
  å°ºå¯¸ï¼š400x100 px
  æ ¼å¼ï¼šPNG
  Base64ï¼š~50-100KB  â† å¯èƒ½è¶…éé™åˆ¶
```

---

## ğŸ¨ è¦–è¦ºå°æ¯”

### ä¿®æ”¹å‰ï¼ˆæ¢ç¢¼åœ–ç‰‡ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœƒå“¡æ¢ç¢¼           â”‚
â”‚  â”ƒâ”ƒâ”ƒ â”ƒâ”ƒ â”ƒâ”ƒâ”ƒ       â”‚ â† Base64 åœ–ç‰‡
â”‚  è«‹åœ¨çµå¸³æ™‚å‡ºç¤ºæ­¤æ¢ç¢¼  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å•é¡Œï¼š**
- âŒ Base64 å¤ªå¤§
- âŒ INVALID_MESSAGE éŒ¯èª¤
- âŒ ç™¼é€å¤±æ•—

---

### ä¿®æ”¹å¾Œï¼ˆæ–‡å­—ç·¨è™Ÿï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœƒå“¡ç·¨è™Ÿ           â”‚
â”‚   M12345            â”‚ â† å¤§å­—é¡¯ç¤º
â”‚  è«‹åœ¨çµå¸³æ™‚å‡ºç¤ºæ­¤ç·¨è™Ÿ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å„ªé»ï¼š**
- âœ… è¨Šæ¯å°
- âœ… ä¸æœƒéŒ¯èª¤
- âœ… ç™¼é€æˆåŠŸ
- âœ… æ¸…æ¥šæ˜“è®€

---

## ğŸ“‹ å…¶ä»– INVALID_MESSAGE åŸå› 

å¦‚æœä¿®æ”¹å¾Œä»ç„¶å‡ºç¾éŒ¯èª¤ï¼Œæª¢æŸ¥ï¼š

### 1. æ–‡å­—å…§å®¹å•é¡Œ

**å¯èƒ½åŸå› ï¼š**
- ç‰¹æ®Šå­—ç¬¦
- Emoji éå¤š
- æ–‡å­—å¤ªé•·

**è§£æ±ºï¼š**
- ç§»é™¤ç‰¹æ®Šå­—ç¬¦
- ç°¡åŒ–è¨Šæ¯å…§å®¹

---

### 2. JSON çµæ§‹å•é¡Œ

**å¯èƒ½åŸå› ï¼š**
- å¿…éœ€æ¬„ä½ç¼ºå¤±
- æ¬„ä½é¡å‹éŒ¯èª¤
- å·¢ç‹€çµæ§‹éŒ¯èª¤

**è§£æ±ºï¼š**
- æª¢æŸ¥ Flex Message JSON
- ä½¿ç”¨ LINE Flex Message Simulator æ¸¬è©¦

---

### 3. æ¬„ä½å€¼è¶…å‡ºé™åˆ¶

**å¯èƒ½åŸå› ï¼š**
- æ–‡å­—å¤ªé•·
- æ•¸å­—è¶…éç¯„åœ
- URL æ ¼å¼éŒ¯èª¤

**è§£æ±ºï¼š**
- ç¸®çŸ­æ–‡å­—
- é©—è­‰æ•¸å€¼
- æª¢æŸ¥ URL æ ¼å¼

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### 1. æ¸…é™¤æˆæ¬Š
- LINE è¨­å®š â†’ éš±ç§è¨­å®š â†’ åˆªé™¤æˆæ¬Š

### 2. é‡æ–°æ¸¬è©¦
- é»æ“Šã€Œç™¼é€æœƒå“¡å¡ã€
- æˆæ¬Š
- ç¢ºèªç™¼é€

### 3. æª¢æŸ¥çµæœ
- âœ… ä¸æœƒå‡ºç¾ INVALID_MESSAGE
- âœ… æˆåŠŸç™¼é€åˆ° LINE
- âœ… çœ‹åˆ°æœƒå“¡å¡ï¼ˆæ–‡å­—ç·¨è™Ÿï¼‰

---

## ğŸ’ª å¦‚æœé‚„æƒ³è¦æ¢ç¢¼

### é¸é … 1ï¼šä½¿ç”¨å¤–éƒ¨åœ–åºŠ

1. ä¸Šå‚³æ¢ç¢¼åœ–ç‰‡åˆ°åœ–åºŠï¼ˆå¦‚ Imgurï¼‰
2. å–å¾— HTTPS URL
3. åœ¨ Flex Message ä¸­ä½¿ç”¨ URL

```javascript
{
    type: 'image',
    url: 'https://i.imgur.com/xxxxx.png',  // å¤–éƒ¨ URL
    size: 'full'
}
```

---

### é¸é … 2ï¼šå‹•æ…‹ç”Ÿæˆæ¢ç¢¼ API

ä½¿ç”¨æ¢ç¢¼ç”Ÿæˆ APIï¼š

```javascript
const barcodeUrl = `https://barcode-api.com/generate?code=${memberData.member_code}`;

{
    type: 'image',
    url: barcodeUrl,
    size: 'full'
}
```

---

### é¸é … 3ï¼šä¿ç•™ç¾ç‹€

**å»ºè­°ï¼š** ä¿æŒç¾åœ¨çš„æ–‡å­—ç·¨è™Ÿæ–¹å¼

**ç†ç”±ï¼š**
- âœ… ç°¡å–®å¯é 
- âœ… ä¸æœƒå‡ºéŒ¯
- âœ… åº—å“¡å¯æ‰‹å‹•è¼¸å…¥
- âœ… æœƒå“¡ç³»çµ±é¦–é ä»æœ‰æ¢ç¢¼

---

## ğŸ¯ çµè«–

### ä¿®æ”¹æ•ˆæœ

**ä¿®æ”¹å‰ï¼š**
- âŒ INVALID_MESSAGE éŒ¯èª¤
- âŒ ç„¡æ³•ç™¼é€

**ä¿®æ”¹å¾Œï¼š**
- âœ… æˆåŠŸç™¼é€
- âœ… è¨Šæ¯æ¸…æ™°
- âœ… ç·¨è™Ÿé†’ç›®

---

### ä½¿ç”¨å»ºè­°

1. **æœƒå“¡å¡ç™¼é€åˆ° LINE**
   - é¡¯ç¤ºæ–‡å­—ç·¨è™Ÿ
   - å¿«é€ŸæŸ¥çœ‹è³‡è¨Š

2. **ç¾å ´çµå¸³**
   - é–‹å•Ÿæœƒå“¡ç³»çµ±é¦–é 
   - é¡¯ç¤ºæ¢ç¢¼æƒæ

3. **æ‰‹å‹•è¼¸å…¥**
   - åº—å“¡å¯è¼¸å…¥ç·¨è™Ÿ
   - ä¸ä¸€å®šéœ€è¦æƒæ

---

## ğŸ‰ å®Œæˆï¼

ç¾åœ¨ã€Œç™¼é€æœƒå“¡å¡ã€åŠŸèƒ½ï¼š
- âœ… ä¸æœƒå‡ºç¾ INVALID_MESSAGE
- âœ… æˆåŠŸç™¼é€ Flex Message
- âœ… æœƒå“¡ç·¨è™Ÿæ¸…æ¥šé¡¯ç¤º
- âœ… å„²å€¼é‡‘å’Œç©åˆ†å®Œæ•´

**ç«‹å³æ¸¬è©¦çœ‹çœ‹ï¼** ğŸ˜Š

---

## ğŸ“š åƒè€ƒè³‡æ–™

- [LINE Flex Message Guidelines](https://developers.line.biz/en/docs/messaging-api/using-flex-messages/)
- [Flex Message Simulator](https://developers.line.biz/flex-simulator/)
- [LINE API éŒ¯èª¤ç¢¼](https://developers.line.biz/en/reference/messaging-api/#error-responses)

