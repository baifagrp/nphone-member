# ğŸ“± LINE Flex Message é ç´„é€šçŸ¥

## âœ¨ æ–°åŠŸèƒ½

é¡§å®¢é ç´„æˆåŠŸé€šçŸ¥å·²å‡ç´šç‚º **LINE Flex Message** æ ¼å¼ï¼

---

## ğŸ¨ è¦–è¦ºæ•ˆæœ

### ä¹‹å‰ï¼ˆç´”æ–‡å­—ï¼‰
```
âœ… é ç´„å·²æˆåŠŸå»ºç«‹ï¼

è¦ªæ„›çš„ å¼µå°æ˜ æ‚¨å¥½ï¼Œ

æ‚¨çš„é ç´„å·²æˆåŠŸæäº¤ï¼Œç›®å‰ç‹€æ…‹ç‚ºã€å¾…ç¢ºèªã€‘

ğŸ“± æœå‹™é …ç›®ï¼šè¢å¹•è²¼è†œ
    é¸é …ï¼šiPhone 14 Pro
ğŸ“… é ç´„æ—¥æœŸï¼š2025-12-14
â° é ç´„æ™‚é–“ï¼š09:00

â³ æˆ‘å€‘å°‡ç›¡å¿«ç‚ºæ‚¨ç¢ºèªé ç´„ï¼Œè«‹ç¨å€™ã€‚
NPHONE æ„Ÿè¬æ‚¨çš„é ç´„ â¤ï¸
```

### ç¾åœ¨ï¼ˆFlex Message å¡ç‰‡ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é ç´„æˆåŠŸï¼                  â”‚ â† ç´«è‰²æ¼¸å±¤æ¨™é¡Œ
â”‚  NPHONE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚  è¦ªæ„›çš„ å¼µå°æ˜ æ‚¨å¥½ï¼Œ         â”‚
â”‚  æ‚¨çš„é ç´„å·²æˆåŠŸæäº¤ï¼         â”‚
â”‚                             â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”    â”‚
â”‚                             â”‚
â”‚  ğŸ“‹ é ç´„è³‡è¨Š                 â”‚
â”‚                             â”‚
â”‚  æœå‹™é …ç›®       è¢å¹•è²¼è†œ     â”‚ â† å°é½Šæ•´é½Š
â”‚  é¸é …          iPhone 14 Proâ”‚
â”‚  é ç´„æ—¥æœŸ       2025-12-14  â”‚
â”‚  é ç´„æ™‚é–“       09:00       â”‚
â”‚                             â”‚
â”‚  â³ å¾…ç¢ºèª                   â”‚
â”‚  æˆ‘å€‘å°‡ç›¡å¿«ç‚ºæ‚¨ç¢ºèªé ç´„       â”‚
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œæ­¡è¿éš¨æ™‚è¯ç¹«ï¼  â”‚
â”‚  NPHONE æ„Ÿè¬æ‚¨çš„é ç´„ â¤ï¸      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ è¨­è¨ˆç‰¹è‰²

### 1. **è¦–è¦ºå±¤æ¬¡** âœ¨
- ğŸ¨ ç´«è‰²æ¼¸å±¤æ¨™é¡Œï¼ˆ#667eeaï¼‰
- ğŸ“Š æ¸…æ™°çš„è³‡è¨Šå€å¡Šåˆ†éš”
- ğŸ¯ é‡è¦è³‡è¨ŠåŠ ç²—é¡¯ç¤º

### 2. **è³‡è¨Šå°é½Š** âœ¨
- ğŸ“‹ æ¬„ä½åç¨±é å·¦
- ğŸ“Œ å…§å®¹æ•¸å€¼é å³
- ğŸ¨ çµ±ä¸€çš„é–“è·å’Œæ’ç‰ˆ

### 3. **å‹•æ…‹å…§å®¹** âœ¨
- âœ… æœ‰æœå‹™é¸é …æ™‚é¡¯ç¤º
- âœ… æœ‰å‚™è¨»æ™‚é¡¯ç¤º
- âœ… ç„¡ä¸å¿…è¦ç©ºç™½è¡Œ

### 4. **ç‹€æ…‹æç¤º** âœ¨
- â³ å¾…ç¢ºèªç‹€æ…‹ï¼ˆæ©˜è‰²ï¼‰
- ğŸ“ æ¸…æ¥šçš„èªªæ˜æ–‡å­—
- ğŸ’¡ æº«é¦¨æç¤º

---

## ğŸ“Š Flex Message çµæ§‹

```json
{
  "type": "flex",
  "altText": "âœ… é ç´„å·²æˆåŠŸå»ºç«‹ï¼",
  "contents": {
    "type": "bubble",
    "size": "mega",
    "header": { 
      // ç´«è‰²æ¨™é¡Œå€
      "backgroundColor": "#667eea"
    },
    "body": {
      // ä¸»è¦å…§å®¹å€
      // - æ­¡è¿è¨Šæ¯
      // - é ç´„è³‡è¨Š
      // - ç‹€æ…‹æç¤º
    },
    "footer": {
      // åº•éƒ¨è¨Šæ¯å€
      // - è¯ç¹«æç¤º
      // - æ„Ÿè¬æ–‡å­—
    }
  }
}
```

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œ

### 1. **å‰ç«¯ï¼ˆnotification.jsï¼‰** âœ…

å»ºç«‹ Flex Message ç‰©ä»¶ï¼š
```javascript
const flexMessage = {
    type: 'flex',
    altText: 'âœ… é ç´„å·²æˆåŠŸå»ºç«‹ï¼',
    contents: {
        type: 'bubble',
        header: {...},
        body: {...},
        footer: {...}
    }
};
```

### 2. **Edge Functionï¼ˆsend-line-messageï¼‰** âœ…

æ”¯æ´å…©ç¨®è¨Šæ¯æ ¼å¼ï¼š
```typescript
// åˆ¤æ–·è¨Šæ¯é¡å‹
if (typeof message === 'object' && message.type === 'flex') {
    // Flex Message
    messagePayload = message;
} else {
    // ç´”æ–‡å­—è¨Šæ¯
    messagePayload = { type: 'text', text: message };
}
```

### 3. **è³‡æ–™åº«è¨˜éŒ„** âœ…

Flex Message ä½¿ç”¨ altText ä½œç‚ºè¨˜éŒ„ï¼š
```typescript
const messageText = typeof message === 'object' && message.altText 
    ? message.altText 
    : message;
```

---

## ğŸ“± å…¶ä»–é€šçŸ¥ä»ç‚ºç´”æ–‡å­—

ç›®å‰åªæœ‰**é ç´„æˆåŠŸé€šçŸ¥**ä½¿ç”¨ Flex Messageï¼š
- âœ… **é ç´„æˆåŠŸ** â†’ Flex Messageï¼ˆå¡ç‰‡æ ¼å¼ï¼‰
- ğŸ“ **é ç´„ç¢ºèª** â†’ ç´”æ–‡å­—
- â° **é ç´„æé†’** â†’ ç´”æ–‡å­—
- ğŸ’° **å„²å€¼é‡‘é€šçŸ¥** â†’ ç´”æ–‡å­—
- â­ **ç©åˆ†é€šçŸ¥** â†’ ç´”æ–‡å­—

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### 1. éƒ¨ç½² Edge Function

```bash
cd supabase/edge-functions
supabase functions deploy send-line-message
```

### 2. æœƒå“¡å»ºç«‹é ç´„

1. æœƒå“¡ç™»å…¥ç³»çµ±
2. é¸æ“‡æœå‹™
3. å¡«å¯«é ç´„è³‡è¨Š
4. æäº¤é ç´„

### 3. æª¢æŸ¥ LINE é€šçŸ¥

åœ¨ LINE ä¸­æ‡‰è©²çœ‹åˆ°ï¼š
- âœ… ç²¾ç¾çš„å¡ç‰‡å¼é€šçŸ¥
- âœ… ç´«è‰²æ¼¸å±¤æ¨™é¡Œ
- âœ… æ•´é½Šå°é½Šçš„è³‡è¨Š
- âœ… æ¸…æ™°çš„ç‹€æ…‹æç¤º

---

## ğŸ¨ è‡ªè¨‚é¡è‰²

å¯ä»¥åœ¨ `js/notification.js` ä¸­ä¿®æ”¹é¡è‰²ï¼š

```javascript
// æ¨™é¡ŒèƒŒæ™¯è‰²
backgroundColor: '#667eea'  // å¯æ”¹ç‚ºå…¶ä»–é¡è‰²

// ç‹€æ…‹é¡è‰²
color: '#FFA500'  // å¾…ç¢ºèªï¼ˆæ©˜è‰²ï¼‰
```

---

## ğŸ“ æ“´å±•å…¶ä»–é€šçŸ¥

å¦‚æœæƒ³å°‡å…¶ä»–é€šçŸ¥ä¹Ÿæ”¹ç‚º Flex Messageï¼š

### ç¯„ä¾‹ï¼šé ç´„ç¢ºèªé€šçŸ¥

```javascript
async sendBookingConfirmed(lineUserId, booking) {
    const flexMessage = {
        type: 'flex',
        altText: 'âœ… é ç´„å·²ç¢ºèªï¼',
        contents: {
            type: 'bubble',
            header: {
                // ç¶ è‰²æ¨™é¡Œï¼ˆå·²ç¢ºèªï¼‰
                backgroundColor: '#4CAF50'
            },
            // ... å…¶ä»–å…§å®¹
        }
    };
    
    return await this.sendLineMessage({
        lineUserId,
        message: flexMessage,
        notificationType: 'booking_confirmed',
        relatedBookingId: booking.id
    });
}
```

---

## ğŸ” é™¤éŒ¯

### æŸ¥çœ‹ Console æ—¥èªŒ

```javascript
// å‰ç«¯
CONFIG.log('ç™¼é€ Flex Message', flexMessage);

// Edge Function
console.log('ğŸ“Š ç™¼é€ Flex Message');
```

### å¸¸è¦‹å•é¡Œ

#### Q1: Flex Message ç„¡æ³•é¡¯ç¤ºï¼Ÿ

**æª¢æŸ¥ï¼š**
- Edge Function æ˜¯å¦å·²é‡æ–°éƒ¨ç½²
- Flex Message çµæ§‹æ˜¯å¦æ­£ç¢º
- LINE Channel Access Token æ˜¯å¦æœ‰æ•ˆ

#### Q2: é¡¯ç¤ºç‚ºç´”æ–‡å­—ï¼Ÿ

**å¯èƒ½åŸå› ï¼š**
- Edge Function ä»ä½¿ç”¨èˆŠç‰ˆæœ¬
- éœ€è¦é‡æ–°éƒ¨ç½²ï¼š`supabase functions deploy send-line-message`

---

## ğŸ“š åƒè€ƒè³‡æ–™

- [LINE Flex Message Simulator](https://developers.line.biz/flex-simulator/)
- [LINE Messaging API æ–‡ä»¶](https://developers.line.biz/en/docs/messaging-api/using-flex-messages/)

---

## ğŸ‰ å®Œæˆï¼

ç¾åœ¨é¡§å®¢æ”¶åˆ°çš„é ç´„é€šçŸ¥ï¼š
- âœ¨ è¦–è¦ºæ›´ç¾è§€
- ğŸ“Š è³‡è¨Šæ›´æ¸…æ™°
- ğŸ’ é«”é©—æ›´å°ˆæ¥­

äº«å—å…¨æ–°çš„ Flex Message é€šçŸ¥å§ï¼ğŸŠ

